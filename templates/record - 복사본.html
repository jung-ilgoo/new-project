<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê²½ê¸° ê¸°ë¡ ì…ë ¥</title>
  <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© CSS CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <!-- Select2 CSS ì¶”ê°€ -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <style>
    /* ì¶”ê°€ ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */
    body {
      background-color: #f4f4f4;
    }
    h1 {
      margin-top: 20px;
    }
    .team-box {
      background-color: #ffffff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    .kda-container {
      display: flex;
      gap: 5px;
    }
    .kda-container input {
      width: 33%;
    }
    /* Select2 ìŠ¤íƒ€ì¼ ì¡°ì • */
    .select2-container {
      width: 100% !important;
      margin-bottom: 5px;
    }
    .select2-container--default .select2-selection--single {
      height: 38px;
      border-radius: 0.375rem;
      border: 1px solid #ced4da;
    }
    .select2-container--default .select2-selection--single .select2-selection__rendered {
      line-height: 36px;
    }
    .select2-container--default .select2-selection--single .select2-selection__arrow {
      height: 36px;
    }
  </style>
</head>
<body>
  <div class="container my-4">
    <h1 class="text-center mb-4">âš” ê²½ê¸° ê¸°ë¡ ì…ë ¥ (KDA, ì±”í”¼ì–¸ í¬í•¨)</h1>
    
    <form action="/record" method="POST" class="bg-white p-4 rounded shadow">
      <!-- ê²½ê¸° ë‚ ì§œ -->
      <div class="mb-3">
        <label for="match_date" class="form-label">ê²½ê¸° ë‚ ì§œ</label>
        <input type="date" id="match_date" name="match_date" class="form-control" required>
      </div>

      <div class="row">
        <!-- ë¸”ë£¨íŒ€ -->
        <div class="col-md-6">
          <div class="p-3 mb-3" style="background-color: #ADD8E6; border-radius: 8px;">
            <h2 class="text-primary">ğŸ”¹ ë¸”ë£¨íŒ€</h2>

            <!-- TOP -->
            <div class="mb-3">
              <label class="form-label">TOP</label>
              <select name="blue_top" class="player-select form-select mb-1" required>
                <option value="" disabled selected>í”Œë ˆì´ì–´ ì„ íƒ</option>
                {% for p in players %}
                <option value="{{ p }}">{{ p }}</option>
                {% endfor %}
              </select>
              <select name="blue_top_champion" class="champion-select form-select mb-1" required>
                <option value="" disabled selected>ì±”í”¼ì–¸ ì„ íƒ</option>
                {% for c in champions %}
                <option value="{{ c }}">{{ c }}</option>
                {% endfor %}
              </select>
              <div class="kda-container">
                <input type="number" name="blue_top_kills" placeholder="í‚¬" min="0" class="form-control" value="">
                <input type="number" name="blue_top_deaths" placeholder="ë°ìŠ¤" min="0" class="form-control" value="">
                <input type="number" name="blue_top_assists" placeholder="ì–´ì‹œ" min="0" class="form-control" value="">
              </div>
            </div>

            <!-- JUNGLE -->
            <div class="mb-3">
              <label class="form-label">JUNGLE</label>
              <select name="blue_jungle" class="player-select form-select mb-1" required>
                <option value="" disabled selected>í”Œë ˆì´ì–´ ì„ íƒ</option>
                {% for p in players %}
                <option value="{{ p }}">{{ p }}</option>
                {% endfor %}
              </select>
              <select name="blue_jungle_champion" class="champion-select form-select mb-1" required>
                <option value="" disabled selected>ì±”í”¼ì–¸ ì„ íƒ</option>
                {% for c in champions %}
                <option value="{{ c }}">{{ c }}</option>
                {% endfor %}
              </select>
              <div class="kda-container">
                <input type="number" name="blue_jungle_kills" placeholder="í‚¬" min="0" class="form-control" value="">
                <input type="number" name="blue_jungle_deaths" placeholder="ë°ìŠ¤" min="0" class="form-control" value="">
                <input type="number" name="blue_jungle_assists" placeholder="ì–´ì‹œ" min="0" class="form-control" value="">
              </div>
            </div>

            <!-- MID -->
            <div class="mb-3">
              <label class="form-label">MID</label>
              <select name="blue_mid" class="player-select form-select mb-1" required>
                <option value="" disabled selected>í”Œë ˆì´ì–´ ì„ íƒ</option>
                {% for p in players %}
                <option value="{{ p }}">{{ p }}</option>
                {% endfor %}
              </select>
              <select name="blue_mid_champion" class="champion-select form-select mb-1" required>
                <option value="" disabled selected>ì±”í”¼ì–¸ ì„ íƒ</option>
                {% for c in champions %}
                <option value="{{ c }}">{{ c }}</option>
                {% endfor %}
              </select>
              <div class="kda-container">
                <input type="number" name="blue_mid_kills" placeholder="í‚¬" min="0" class="form-control" value="">
                <input type="number" name="blue_mid_deaths" placeholder="ë°ìŠ¤" min="0" class="form-control" value="">
                <input type="number" name="blue_mid_assists" placeholder="ì–´ì‹œ" min="0" class="form-control" value="">
              </div>
            </div>

            <!-- ADC -->
            <div class="mb-3">
              <label class="form-label">ADC</label>
              <select name="blue_adc" class="player-select form-select mb-1" required>
                <option value="" disabled selected>í”Œë ˆì´ì–´ ì„ íƒ</option>
                {% for p in players %}
                <option value="{{ p }}">{{ p }}</option>
                {% endfor %}
              </select>
              <select name="blue_adc_champion" class="champion-select form-select mb-1" required>
                <option value="" disabled selected>ì±”í”¼ì–¸ ì„ íƒ</option>
                {% for c in champions %}
                <option value="{{ c }}">{{ c }}</option>
                {% endfor %}
              </select>
              <div class="kda-container">
                <input type="number" name="blue_adc_kills" placeholder="í‚¬" min="0" class="form-control" value="">
                <input type="number" name="blue_adc_deaths" placeholder="ë°ìŠ¤" min="0" class="form-control" value="">
                <input type="number" name="blue_adc_assists" placeholder="ì–´ì‹œ" min="0" class="form-control" value="">
              </div>
            </div>

            <!-- SUPPORT -->
            <div class="mb-3">
              <label class="form-label">SUPPORT</label>
              <select name="blue_support" class="player-select form-select mb-1" required>
                <option value="" disabled selected>í”Œë ˆì´ì–´ ì„ íƒ</option>
                {% for p in players %}
                <option value="{{ p }}">{{ p }}</option>
                {% endfor %}
              </select>
              <select name="blue_support_champion" class="champion-select form-select mb-1" required>
                <option value="" disabled selected>ì±”í”¼ì–¸ ì„ íƒ</option>
                {% for c in champions %}
                <option value="{{ c }}">{{ c }}</option>
                {% endfor %}
              </select>
              <div class="kda-container">
                <input type="number" name="blue_support_kills" placeholder="í‚¬" min="0" class="form-control" value="">
                <input type="number" name="blue_support_deaths" placeholder="ë°ìŠ¤" min="0" class="form-control" value="">
                <input type="number" name="blue_support_assists" placeholder="ì–´ì‹œ" min="0" class="form-control" value="">
              </div>
            </div>
          </div>
        </div>

        <!-- ë ˆë“œíŒ€ -->
        <div class="col-md-6">
          <div class="p-3 mb-3" style="background-color: #FFB6C1; border-radius: 8px;">
            <h2 class="text-danger">ğŸ”º ë ˆë“œíŒ€</h2>

            <!-- TOP -->
            <div class="mb-3">
              <label class="form-label">TOP</label>
              <select name="red_top" class="player-select form-select mb-1" required>
                <option value="" disabled selected>í”Œë ˆì´ì–´ ì„ íƒ</option>
                {% for p in players %}
                <option value="{{ p }}">{{ p }}</option>
                {% endfor %}
              </select>
              <select name="red_top_champion" class="champion-select form-select mb-1" required>
                <option value="" disabled selected>ì±”í”¼ì–¸ ì„ íƒ</option>
                {% for c in champions %}
                <option value="{{ c }}">{{ c }}</option>
                {% endfor %}
              </select>
              <div class="kda-container">
                <input type="number" name="red_top_kills" placeholder="í‚¬" min="0" class="form-control" value="">
                <input type="number" name="red_top_deaths" placeholder="ë°ìŠ¤" min="0" class="form-control" value="">
                <input type="number" name="red_top_assists" placeholder="ì–´ì‹œ" min="0" class="form-control" value="">
              </div>
            </div>

            <!-- JUNGLE -->
            <div class="mb-3">
              <label class="form-label">JUNGLE</label>
              <select name="red_jungle" class="player-select form-select mb-1" required>
                <option value="" disabled selected>í”Œë ˆì´ì–´ ì„ íƒ</option>
                {% for p in players %}
                <option value="{{ p }}">{{ p }}</option>
                {% endfor %}
              </select>
              <select name="red_jungle_champion" class="champion-select form-select mb-1" required>
                <option value="" disabled selected>ì±”í”¼ì–¸ ì„ íƒ</option>
                {% for c in champions %}
                <option value="{{ c }}">{{ c }}</option>
                {% endfor %}
              </select>
              <div class="kda-container">
                <input type="number" name="red_jungle_kills" placeholder="í‚¬" min="0" class="form-control" value="">
                <input type="number" name="red_jungle_deaths" placeholder="ë°ìŠ¤" min="0" class="form-control" value="">
                <input type="number" name="red_jungle_assists" placeholder="ì–´ì‹œ" min="0" class="form-control" value="">
              </div>
            </div>

            <!-- MID -->
            <div class="mb-3">
              <label class="form-label">MID</label>
              <select name="red_mid" class="player-select form-select mb-1" required>
                <option value="" disabled selected>í”Œë ˆì´ì–´ ì„ íƒ</option>
                {% for p in players %}
                <option value="{{ p }}">{{ p }}</option>
                {% endfor %}
              </select>
              <select name="red_mid_champion" class="champion-select form-select mb-1" required>
                <option value="" disabled selected>ì±”í”¼ì–¸ ì„ íƒ</option>
                {% for c in champions %}
                <option value="{{ c }}">{{ c }}</option>
                {% endfor %}
              </select>
              <div class="kda-container">
                <input type="number" name="red_mid_kills" placeholder="í‚¬" min="0" class="form-control" value="">
                <input type="number" name="red_mid_deaths" placeholder="ë°ìŠ¤" min="0" class="form-control" value="">
                <input type="number" name="red_mid_assists" placeholder="ì–´ì‹œ" min="0" class="form-control" value="">
              </div>
            </div>

            <!-- ADC -->
            <div class="mb-3">
              <label class="form-label">ADC</label>
              <select name="red_adc" class="player-select form-select mb-1" required>
                <option value="" disabled selected>í”Œë ˆì´ì–´ ì„ íƒ</option>
                {% for p in players %}
                <option value="{{ p }}">{{ p }}</option>
                {% endfor %}
              </select>
              <select name="red_adc_champion" class="champion-select form-select mb-1" required>
                <option value="" disabled selected>ì±”í”¼ì–¸ ì„ íƒ</option>
                {% for c in champions %}
                <option value="{{ c }}">{{ c }}</option>
                {% endfor %}
              </select>
              <div class="kda-container">
                <input type="number" name="red_adc_kills" placeholder="í‚¬" min="0" class="form-control" value="">
                <input type="number" name="red_adc_deaths" placeholder="ë°ìŠ¤" min="0" class="form-control" value="">
                <input type="number" name="red_adc_assists" placeholder="ì–´ì‹œ" min="0" class="form-control" value="">
              </div>
            </div>

            <!-- SUPPORT -->
            <div class="mb-3">
              <label class="form-label">SUPPORT</label>
              <select name="red_support" class="player-select form-select mb-1" required>
                <option value="" disabled selected>í”Œë ˆì´ì–´ ì„ íƒ</option>
                {% for p in players %}
                <option value="{{ p }}">{{ p }}</option>
                {% endfor %}
              </select>
              <select name="red_support_champion" class="champion-select form-select mb-1" required>
                <option value="" disabled selected>ì±”í”¼ì–¸ ì„ íƒ</option>
                {% for c in champions %}
                <option value="{{ c }}">{{ c }}</option>
                {% endfor %}
              </select>
              <div class="kda-container">
                <input type="number" name="red_support_kills" placeholder="í‚¬" min="0" class="form-control" value="">
                <input type="number" name="red_support_deaths" placeholder="ë°ìŠ¤" min="0" class="form-control" value="">
                <input type="number" name="red_support_assists" placeholder="ì–´ì‹œ" min="0" class="form-control" value="">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ìŠ¹ë¦¬ íŒ€ ì„ íƒ -->
      <div class="mb-3 text-center">
        <h4>ğŸ† ìŠ¹ë¦¬ íŒ€</h4>
        <select id="winner" name="winner" class="form-select w-50 mx-auto" required>
          <option value="" selected disabled>ì„ íƒí•˜ì„¸ìš”</option>
          <option value="blue">ë¸”ë£¨íŒ€</option>
          <option value="red">ë ˆë“œíŒ€</option>
        </select>
      </div>

      <!-- ì œì¶œ ë²„íŠ¼ -->
      <div class="text-center">
        <button type="submit" class="btn btn-success px-4 py-2">ê²½ê¸° ê¸°ë¡ ì €ì¥</button>
      </div>
    </form>
  </div>
<!-- ê¸°ì¡´ HTML ë¶€ë¶„ì€ ìœ ì§€í•˜ê³  ìŠ¤í¬ë¦½íŠ¸ ë¶€ë¶„ë§Œ êµì²´í•  ê²ƒì…ë‹ˆë‹¤ -->

<!-- jQuery ì¶”ê°€ -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Select2 JS ì¶”ê°€ -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<!-- ê²€ìƒ‰ ê¸°ëŠ¥ ì´ˆê¸°í™” -->
  <script>
      $(document).ready(function() {
        // ê¸°ë³¸ì ì¸ Select2 ì„¤ì •ì—ì„œ ì—¬ëŸ¬ ì˜µì…˜ì„ ìµœì†Œí™”í•˜ì—¬ ê¸°ë³¸ ë™ì‘ì— ê°€ê¹ê²Œ ìœ ì§€
        $('.player-select, .champion-select').select2({
          placeholder: "ì„ íƒí•˜ì„¸ìš”",
          allowClear: true,
          // selectOnClose ì˜µì…˜ ì œê±°
          language: {
            noResults: function() {
              return "ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤";
            },
            searching: function() {
              return "ê²€ìƒ‰ ì¤‘...";
            }
          }
        });
        
        // ì „ì—­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì¶”ê°€í•˜ì—¬ DOM ë³€í™”ë¥¼ ê°ì§€
        $(document).on('focus', '.select2-selection', function(e) {
          // Select2 ì»¨í…Œì´ë„ˆ ìš”ì†Œì˜ ID ê°€ì ¸ì˜¤ê¸° 
          const containerId = $(this).closest('.select2-container').attr('id');
          // IDì—ì„œ ì›ë˜ select ìš”ì†Œì˜ ID ì¶”ì¶œ
          const selectId = containerId.replace('select2-', '').replace('-container', '');
          // ì›ë˜ select ìš”ì†Œ ì°¾ê¸°
          const $select = $(`#${selectId}`);
          
          // íƒ­ í‚¤ê°€ ëˆŒë ¸ì„ ë•Œë§Œ ìë™ìœ¼ë¡œ ë“œë¡­ë‹¤ìš´ ì—´ê¸°
          if ($select.length) {
            // ë“œë¡­ë‹¤ìš´ ì—´ê¸°
            $select.select2('open');
            
            // ëª¨ë“  ë“œë¡­ë‹¤ìš´ì´ ì—´ë¦° í›„ ê²€ìƒ‰ í•„ë“œì— í¬ì»¤ìŠ¤ ì£¼ê¸°
            setTimeout(function() {
              $('.select2-search__field:visible').focus();
            }, 50);
          }
        });
        
        // ê° select ìš”ì†Œì— ì§ì ‘ keydown í•¸ë“¤ëŸ¬ ì¶”ê°€
        $('.player-select, .champion-select').on('keydown', function(e) {
          // ì—”í„° í‚¤ ì²˜ë¦¬ - ë“œë¡­ë‹¤ìš´ í† ê¸€
          if (e.key === 'Enter' && !$('.select2-search__field:visible').length) {
            e.preventDefault();
            $(this).select2('open');
            return;
          }
        });
        
        // KDA ì…ë ¥ í•„ë“œê°€ íƒ­ìœ¼ë¡œ ë„˜ì–´ê°ˆ ë•Œ ë‹¤ìŒ í•„ë“œ/ì„¹ì…˜ìœ¼ë¡œ ì ì ˆíˆ ì´ë™
        $('.kda-container input:last-child').on('keydown', function(e) {
          if (e.key === 'Tab' && !e.shiftKey) {
            const $currentSection = $(this).closest('.mb-3');
            const $nextSection = $currentSection.next('.mb-3');
            
            if ($nextSection.length) {
              // ë‹¤ìŒ í¬ì§€ì…˜ì´ ìˆëŠ” ê²½ìš°
              // íƒ­ ë™ì‘ì„ ë§‰ê³  ëª…ì‹œì ìœ¼ë¡œ í¬ì»¤ìŠ¤ ì´ë™
              e.preventDefault();
              const $nextSelect = $nextSection.find('.player-select');
              $nextSelect.focus();
              $nextSelect.select2('open');
            }
          }
        });
        
        // ìŠ¹ë¦¬ íŒ€ ì„ íƒë„ í¬ì»¤ìŠ¤ ë°›ì„ ë•Œ ìë™ìœ¼ë¡œ ë“œë¡­ë‹¤ìš´ ì—´ê¸°
        $('#winner').on('focus', function() {
          $(this).click();
        });
        
        // Select2 ì—´ë¦´ ë•Œ í•­ìƒ ê²€ìƒ‰ í•„ë“œ í¬ì»¤ìŠ¤
        $(document).on('select2:open', function() {
          setTimeout(() => {
            document.querySelector('.select2-container--open .select2-search__field').focus();
          }, 10);
        });
        
        // Tab í‚¤ê°€ ì¼ë°˜ì ì¸ ë™ì‘ì„ ë²—ì–´ë‚  ë•Œë¥¼ ìœ„í•œ ë³´ì¡° ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        $(document).on('keydown', function(e) {
          if (e.key === 'Tab') {
            // ì•½ê°„ì˜ ì§€ì—° í›„ í™•ì¸
            setTimeout(function() {
              const $focused = $(':focus');
              
              // ë§Œì•½ í¬ì»¤ìŠ¤ëœ ìš”ì†Œê°€ select2 ì»¨í…Œì´ë„ˆë¼ë©´
              if ($focused.hasClass('select2-selection')) {
                const $select = $focused.closest('.select2-container').siblings('select');
                if ($select.length) {
                  $select.select2('open');
                }
              }
            }, 0);
          }
        });
        
        // íŠ¹ë³„íˆ ì²« ë²ˆì§¸ ìš”ì†Œì— í¬ì»¤ìŠ¤ - í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í¬ì»¤ìŠ¤
        setTimeout(function() {
          $('input[name="match_date"]').focus();
        }, 500);
      });
  </script>
</body>
</html>